import{u as A,P as se,_ as ie,C as le,a as re}from"./vue-flow-core-167591f5.js";import{D as Z,m as de,a3 as O,o as s,c as p,J as u,a as y,u as c,f as _,b as w,y as ce,I as W,g as D,F as ue,j as M,_ as N,V as q,r as fe,a4 as H,q as ve,G as J,H as pe}from"./app-ec99bd87.js";import{_ as he}from"./start-node.vue_vue_type_script_setup_true_lang-8022493b.js";import me from"./Buttons-node-14a3370b.js";import _e from"./List-node-89edaa5a.js";import{_ as ge}from"./Media-node.vue_vue_type_script_setup_true_lang-afefa7e8.js";import{_ as we}from"./Text-node.vue_vue_type_script_setup_true_lang-4ebb98c2.js";import ye from"./Action-node-20a5a029.js";var v=(e=>(e.Lines="lines",e.Dots="dots",e))(v||{});const K=function({dimensions:e,size:a,color:n}){return W("path",{stroke:n,"stroke-width":a,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})},Q=function({radius:e,color:a}){return W("circle",{cx:e,cy:e,r:e,fill:a})};v.Lines+"",v.Dots+"";const $e={[v.Dots]:"#81818a",[v.Lines]:"#eee"},ze=["id","x","y","width","height","patternTransform"],Ce={key:2,height:"100",width:"100"},ke=["fill"],Ve=["x","y","fill"],be={name:"Background",compatConfig:{MODE:3}},He=Z({...be,props:{id:{},variant:{default:()=>v.Dots},gap:{default:20},size:{default:1},lineWidth:{default:1},patternColor:{},color:{},bgColor:{},height:{default:100},width:{default:100},x:{default:0},y:{default:0},offset:{default:2}},setup(e){const{id:a,viewport:n}=A(),r=de(()=>{const[o,m]=Array.isArray(e.gap)?e.gap:[e.gap,e.gap],$=[o*n.value.zoom||1,m*n.value.zoom||1],g=e.size*n.value.zoom,z=e.variant===v.Dots?[g/e.offset,g/e.offset]:[$[0]/e.offset,$[1]/e.offset];return{scaledGap:$,offset:z,size:g}}),f=O(()=>`pattern-${a}${e.id?`-${e.id}`:""}`),h=O(()=>e.color||e.patternColor||$e[e.variant||v.Dots]);return(o,m)=>(s(),p("svg",{class:"vue-flow__background vue-flow__container",style:ce({height:`${o.height>100?100:o.height}%`,width:`${o.width>100?100:o.width}%`})},[u(o.$slots,"pattern-container",{id:f.value},()=>[y("pattern",{id:f.value,x:c(n).x%r.value.scaledGap[0],y:c(n).y%r.value.scaledGap[1],width:r.value.scaledGap[0],height:r.value.scaledGap[1],patternTransform:`translate(-${r.value.offset[0]},-${r.value.offset[1]})`,patternUnits:"userSpaceOnUse"},[u(o.$slots,"pattern",{},()=>[o.variant===c(v).Lines?(s(),_(c(K),{key:0,size:o.lineWidth,color:h.value,dimensions:r.value.scaledGap},null,8,["size","color","dimensions"])):o.variant===c(v).Dots?(s(),_(c(Q),{key:1,color:h.value,radius:r.value.size/o.offset},null,8,["color","radius"])):w("",!0),o.bgColor?(s(),p("svg",Ce,[y("rect",{width:"100%",height:"100%",fill:o.bgColor},null,8,ke)])):w("",!0)])],8,ze)]),y("rect",{x:o.x,y:o.y,width:"100%",height:"100%",fill:`url(#${f.value})`},null,8,Ve),u(o.$slots,"default",{id:f.value})],4))}}),De={name:"ControlButton",compatConfig:{MODE:3}},Me=(e,a)=>{const n=e.__vccOpts||e;for(const[r,f]of a)n[r]=f;return n},Be={class:"vue-flow__controls-button"};function Ie(e,a,n,r,f,h){return s(),p("button",Be,[u(e.$slots,"default")])}const F=Me(De,[["render",Ie]]),Ne={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Oe=y("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),xe=[Oe];function Le(e,a){return s(),p("svg",Ne,xe)}const Se={render:Le},Fe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Pe=y("path",{d:"M0 0h32v4.2H0z"},null,-1),Te=[Pe];function Ge(e,a){return s(),p("svg",Fe,Te)}const Ee={render:Ge},Ae={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Ze=y("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Re=[Ze];function Xe(e,a){return s(),p("svg",Ae,Re)}const Ye={render:Xe},je={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Ue=y("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),qe=[Ue];function Je(e,a){return s(),p("svg",je,qe)}const We={render:Je},Ke={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Qe=y("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),et=[Qe];function tt(e,a){return s(),p("svg",Ke,et)}const ot={render:tt},nt={name:"Controls",compatConfig:{MODE:3}},at=Z({...nt,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>se.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(e,{emit:a}){const{nodesDraggable:n,nodesConnectable:r,elementsSelectable:f,setInteractive:h,zoomIn:o,zoomOut:m,fitView:$,viewport:g,minZoom:z,maxZoom:P}=A(),C=O(()=>n.value||r.value||f.value),T=O(()=>g.value.zoom<=z.value),R=O(()=>g.value.zoom>=P.value);function B(){o(),a("zoomIn")}function I(){m(),a("zoomOut")}function x(){$(e.fitViewParams),a("fitView")}function G(){h(!C.value),a("interactionChange",!C.value)}return(i,X)=>(s(),_(c(ie),{class:"vue-flow__controls",position:i.position},{default:D(()=>[u(i.$slots,"top"),i.showZoom?(s(),p(ue,{key:0},[u(i.$slots,"control-zoom-in",{},()=>[M(F,{class:"vue-flow__controls-zoomin",disabled:R.value,onClick:B},{default:D(()=>[u(i.$slots,"icon-zoom-in",{},()=>[(s(),_(N(c(Se))))])]),_:3},8,["disabled"])]),u(i.$slots,"control-zoom-out",{},()=>[M(F,{class:"vue-flow__controls-zoomout",disabled:T.value,onClick:I},{default:D(()=>[u(i.$slots,"icon-zoom-out",{},()=>[(s(),_(N(c(Ee))))])]),_:3},8,["disabled"])])],64)):w("",!0),i.showFitView?u(i.$slots,"control-fit-view",{key:1},()=>[M(F,{class:"vue-flow__controls-fitview",onClick:x},{default:D(()=>[u(i.$slots,"icon-fit-view",{},()=>[(s(),_(N(c(Ye))))])]),_:3})]):w("",!0),i.showInteractive?u(i.$slots,"control-interactive",{key:2},()=>[i.showInteractive?(s(),_(F,{key:0,class:"vue-flow__controls-interactive",onClick:G},{default:D(()=>[C.value?u(i.$slots,"icon-unlock",{key:0},()=>[(s(),_(N(c(ot))))]):w("",!0),C.value?w("",!0):u(i.$slots,"icon-lock",{key:1},()=>[(s(),_(N(c(We))))])]),_:3})):w("",!0)]):w("",!0),u(i.$slots,"default")]),_:3},8,["position"]))}}),st={nodes:[{type:"LLM",data:{title:"LLM",output:[{name:"output1",type:"",description:"balabala"}]},events:{},id:"1",position:{x:-413.62574973269915,y:110.25705825948319},label:"LLM node"},{type:"code",data:{title:"code",output:[{name:"key0",type:"String",description:"just for test"}]},events:{},id:"2",position:{x:262.70018202243125,y:-104.44788021583054},label:"code node"},{type:"knowledge",data:{title:"knowledge",output:[{name:"output"}]},events:{},id:"3",position:{x:939.64275630104,y:51.1990333957562},label:"knowledge node"}],edges:[{sourceHandle:"1__handle-right",targetHandle:"2__handle-left",type:"default",source:"1",target:"2",data:{},events:{},id:"vueflow__edge-11__handle-right-22__handle-left",sourceX:200.40522146581822,sourceY:488.25689832215323,targetX:253.70017309626013,targetY:364.55198874414043},{sourceHandle:"2__handle-right",targetHandle:"3__handle-left",type:"default",source:"2",target:"3",data:{},events:{},id:"vueflow__edge-22__handle-right-33__handle-left",sourceX:871.6999267177814,sourceY:364.55198874414043,targetX:930.6427473748689,targetY:342.1989975362437}],position:[-151.90460217317343,183.68497815279642],zoom:.5802807591037111,viewport:{x:-151.90460217317343,y:183.68497815279642,zoom:.5802807591037111}},pt=Z({__name:"main-canvas",props:["uuid","flow","contactGroups","contactFields"],emits:["updateStatus","updatePayload"],setup(e,{emit:a}){const n=e;q("contactGroups",n.contactGroups||[]),q("contactFields",n.contactFields||[]);const r=fe(),f={start:H(he),list:H(_e),buttons:H(me),media:H(ge),text:H(we),action:H(ye)},{findNode:h,nodes:o,edges:m,viewport:$,addNodes:g,addEdges:z,project:P,vueFlowRef:C,onConnect:T,onNodeDragStop:R,setNodes:B,setEdges:I,setViewport:x,onViewportChange:G}=A();ve(()=>{if(n.flow.metadata){const t=JSON.parse(n.flow.metadata);t.nodes&&t.nodes.filter(l=>l.type==="action"),B(t.nodes||[]),I(t.edges||[]),x(t.viewport||[])}else B([{id:"1",type:"start",label:"start",position:{x:25,y:10},data:{uuid:n.uuid,title:"start",metadata:{fields:[]}}}])}),J([o,m],()=>{o.value.filter(l=>l.type==="action").length>0,Y()},{deep:!0}),T(t=>{const l=h(t.source);if(h(t.target),l&&l.type==="start"){z(t);return}if(t.source&&t.target){const k=m.value.filter(V=>V.source===t.source&&V.sourceHandle===t.sourceHandle);if(k.length>0){const V=k.map(b=>b.id);I(m.value.filter(b=>!V.includes(b.id)))}z(t)}else z(t)}),G(()=>{Y()});const i=a,X=t=>{switch(t){case"add_to_group":case"remove_from_group":return{group_id:""};case"update_contact":return{target_field:"",invalid_email_message:"Please provide a valid email address.",fields:{first_name:"",last_name:"",email:"",phone:"",address:{street:"",city:"",state:"",zip:"",country:""},metadata:{}}};case"send_email":return{subject:"",body:"",smtp_host:"",smtp_port:587,smtp_username:"",smtp_password:"",smtp_encryption:"tls",from_name:""};case"delay":return{duration:5};case"webhook":return{url:"",method:"POST"};case"ai_response":return{prompt:"",proceed_condition:"always",confidence_threshold:.8,low_confidence_message:""};case"conditional":return{condition_type:"message_contains",field_name:"",field_operator:"equals",variable_name:"",variable_operator:"equals",conditions:[]};default:return{}}},Y=()=>{i("updatePayload",JSON.stringify({nodes:o.value,edges:m.value,viewport:$.value}))};function ee(t){var U;const l=(U=t.dataTransfer)==null?void 0:U.getData("application/vueflow");if(l==="workflow"){const{nodes:d,edges:E,position:S,zoom:oe}=st,[ne=0,ae=0]=S;B(d),I(E),x({x:ne,y:ae,zoom:oe||0});return}const{left:k,top:V}=C.value.getBoundingClientRect(),b=P({x:t.clientX-k,y:t.clientY-V}),j=o.value.length?Math.max(...o.value.map(d=>parseInt(d.id,10)))+1:1;let L;if(l&&l.startsWith("action-")){const d=l.replace("action-","").replace(/-/g,"_");L={id:(j+1).toString(),type:"action",position:b,label:`${d} action`,data:{uuid:n.uuid,title:d,actionType:d,config:X(d),is_active:!0}}}else L={id:(j+1).toString(),type:l,position:b,label:`${l} node`,data:{uuid:n.uuid,title:l,metadata:{fields:[]}}};g([L]),pe(()=>{const d=h(L.id),E=J(()=>d.dimensions,S=>{S.width>0&&S.height>0&&d&&(d.position={x:d.position.x-d.dimensions.width/2,y:d.position.y-d.dimensions.height/2},E())},{deep:!0,flush:"post"})})}function te(t){t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move")}return(t,l)=>(s(),p("div",{class:"relative h-full w-full",id:"main-canvas",onDrop:ee,onDragover:te},[M(c(re),{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=k=>r.value=k),"node-types":f,"connection-mode":c(le).Strict},{default:D(()=>[M(c(at)),M(c(He))]),_:1},8,["modelValue","connection-mode"])],32))}});export{pt as _};
